<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spaza Track - Firebase</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icons/icon-192x192.png">
    <meta name="theme-color" content="#2c3e50">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen" style="display: flex;">
        <div class="spinner"></div>
        <p>Loading Spaza Track...</p>
    </div>

    <!-- Auth Required Screen -->
    <div id="auth-required" class="auth-screen" style="display: none;">
        <div class="auth-container">
            <h1>üè™ Spaza Track</h1>
            <p>Please log in to continue</p>
            <button id="login-btn" class="btn-primary">Login with Google</button>
        </div>
    </div>

    <!-- Shop Selection Screen -->
    <div id="shop-selection" class="auth-screen" style="display: none;">
        <div class="auth-container">
            <h1>Select Your Shop</h1>
            <div id="shop-list"></div>
            
            <div class="shop-actions">
                <button id="create-shop-btn" class="btn-primary">Create New Shop</button>
                <button id="join-shop-btn" class="btn-secondary">Join Existing Shop</button>
            </div>

            <!-- Create Shop Form -->
            <div id="create-shop-form" style="display: none;">
                <h3>Create New Shop</h3>
                <input type="text" id="new-shop-name" placeholder="Shop Name" required>
                <div class="form-actions">
                    <button id="create-shop-submit" class="btn-primary">Create</button>
                    <button id="create-shop-cancel" class="btn-secondary">Cancel</button>
                </div>
            </div>

            <!-- Join Shop Form -->
            <div id="join-shop-form" style="display: none;">
                <h3>Join Existing Shop</h3>
                <input type="text" id="join-shop-name" placeholder="Shop Name">
                <input type="text" id="join-shop-id" placeholder="Shop ID (optional)">
                <div class="form-actions">
                    <button id="join-shop-submit" class="btn-primary">Join</button>
                    <button id="join-shop-cancel" class="btn-secondary">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="main-app" style="display: none;">
        <!-- Header -->
        <header class="app-header">
            <h1>üè™ Spaza Track</h1>
            <div class="header-info">
                <span id="shop-name">Shop Name</span>
                <span id="user-name">User</span>
                <button id="logout-btn" class="btn-secondary">Logout</button>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-tabs">
            <button class="nav-btn active" data-tab="dashboard">Dashboard</button>
            <button class="nav-btn" data-tab="products">Products</button>
            <button class="nav-btn" data-tab="sales">Sales</button>
            <button class="nav-btn" data-tab="reports">Reports</button>
            <button class="nav-btn" data-tab="activity">Activity</button>
        </nav>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="dashboard-stats">
                <div class="stat-card">
                    <h3>Total Products</h3>
                    <div class="stat-value" id="total-products">0</div>
                </div>
                <div class="stat-card">
                    <h3>Total Stock</h3>
                    <div class="stat-value" id="total-stock">0</div>
                </div>
                <div class="stat-card">
                    <h3>Stock Value</h3>
                    <div class="stat-value" id="stock-value">R0.00</div>
                </div>
                <div class="stat-card">
                    <h3>Today's Sales</h3>
                    <div class="stat-value" id="todays-sales">R0.00</div>
                </div>
            </div>

            <div class="dashboard-sections">
                <section class="low-stock">
                    <h3>üö® Low Stock Alerts</h3>
                    <div id="low-stock-list">
                        <p>No low stock items</p>
                    </div>
                </section>

                <section class="recent-sales">
                    <h3>üìä Recent Sales</h3>
                    <div id="recent-sales-list">
                        <p>No recent sales</p>
                    </div>
                </section>
            </div>
        </div>

        <!-- Products Tab -->
        <div id="products" class="tab-content">
            <div class="section-header">
                <h2>Products</h2>
                <button id="add-product-btn" class="btn-primary">Add Product</button>
            </div>
            
            <div id="products-list" class="items-grid">
                <!-- Products will be loaded here -->
            </div>
        </div>

        <!-- Sales Tab -->
        <div id="sales" class="tab-content">
            <div class="section-header">
                <h2>Record Sale</h2>
            </div>
            
            <form id="sale-form" class="form-grid">
                <select id="sale-product" required>
                    <option value="">Select Product</option>
                </select>
                
                <input type="number" id="sale-quantity" placeholder="Quantity" min="1" required>
                
                <button type="submit" class="btn-primary">Record Sale</button>
            </form>

            <div class="section-header" style="margin-top: 2rem;">
                <h3>Sales History</h3>
                <input type="date" id="sales-date-filter">
            </div>
            
            <div id="sales-list" class="sales-history">
                <!-- Sales will be loaded here -->
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <h2>Reports & Analytics</h2>
            <div class="reports-grid">
                <div class="report-card">
                    <h3>Daily Summary</h3>
                    <div id="daily-summary">Loading...</div>
                </div>
                <div class="report-card">
                    <h3>Top Products</h3>
                    <div id="top-products">Loading...</div>
                </div>
                <div class="report-card">
                    <h3>Profit Analysis</h3>
                    <div id="profit-analysis">Loading...</div>
                </div>
            </div>
        </div>

        <!-- Activity Tab -->
        <div id="activity" class="tab-content">
            <h2>Activity Log</h2>
            <div id="activity-list" class="activity-log">
                <!-- Activity will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="product-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="product-modal-title">Add Product</h2>
            <form id="product-form">
                <input type="hidden" id="product-id">
                <input type="text" id="product-name" placeholder="Product Name" required>
                <input type="number" id="product-cost" placeholder="Cost Price" step="0.01" required>
                <input type="number" id="product-price" placeholder="Selling Price" step="0.01" required>
                <input type="number" id="product-quantity" placeholder="Initial Quantity" min="0" required>
                <textarea id="product-description" placeholder="Description (optional)"></textarea>
                <div class="form-actions">
                    <button type="submit" class="btn-primary">Save Product</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('product-modal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase SDK v10 -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Make Firebase available globally
        window.Firebase = {
            initializeApp,
            getAuth,
            signInWithPopup,
            GoogleAuthProvider,
            signOut,
            onAuthStateChanged,
            getFirestore
        };
        
        // Load Firebase modules
        import('./firebase-config.js');
        import('./firebase-service.js');
        import('./app-firebase.js');
    </script>
    
    <!-- Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>
</body>
</html>